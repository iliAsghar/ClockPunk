<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24-Hour Clock</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            display: flex; /* Use flexbox for layout */
            flex-direction: column; /* Stack children vertically */
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #232526 0%, #000000 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .clock-container {
            width: 90%;
            max-width: 1000px;
            position: relative;
        }

        .clock-title {
            text-align: center;
            color: #e0e0e0;
            font-size: 28px;
            margin-bottom: 50px;
            position: relative;
        }

        .clock-line {
            height: 4px;
            background: rgb(45, 45, 45);
            position: relative;
            border-radius: 2px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .hour-mark {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 2px;
            height: 14px;
            background: rgb(135, 135, 135);
        }

        .hour-label {
            position: absolute;
            top: -30px;
            transform: translateX(-50%);
            font-size: 16px;
            font-weight: bold;
            color: rgb(180, 180, 180);
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
        }

        .friend-container {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            /* Add padding to create a large, invisible hover area */
            padding: 30px 10px;
        }
        
        .timezone-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 3px;
            height: 20px;
            transform: translate(-50%, -50%);
            border-radius: 2px; /* Keep this for rounded corners */
        }

        .tooltip {
            visibility: hidden;
            position: absolute;
            bottom: 150%; /* Position above the indicator */
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 16px;
            white-space: nowrap;
            z-index: 1;
        }

        .friend-container:hover .tooltip {
            visibility: visible;
        }

        .timezone-indicator {
            animation: gentle-glow 2s infinite ease-in-out;
        }

        @keyframes gentle-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .legend-container {
            width: 90%;
            max-width: 1000px;
            margin-top: 40px;
            display: flex;
            flex-direction: column; /* Arrange items in a vertical list */
            gap: 10px; /* Space between list items */
        }

        .legend-item {
            display: flex;
            align-items: center;
            color: #e0e0e0;
        }

        .legend-color-swatch {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 8px;
        }

        .legend-names {
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="clock-container">
        <h1 class="clock-title">üï∞Ô∏è World Clock</h1>
        <div class="clock-line" id="clockLine"></div>
    </div>
    <div class="legend-container" id="legendContainer"></div>

    <script src="times/timezones.js"></script>
    <script>
        const clockLine = document.getElementById('clockLine');
        const lineWidth = clockLine.offsetWidth;

        // Create hour marks and labels
        for (let hour = 0; hour <= 24; hour++) {
            const percentage = (hour / 24) * 100;
            const position = (hour / 24) * lineWidth;

            // Create hour mark
            const mark = document.createElement('div');
            mark.className = 'hour-mark';
            mark.style.left = percentage + '%';
            clockLine.appendChild(mark);

            // Create hour label
            const label = document.createElement('div');
            label.className = 'hour-label';
            label.textContent = hour;
            label.style.left = percentage + '%';
            clockLine.appendChild(label);
        }

        // Group friends by timezone to combine indicators
        const timezonesToFriends = friendsTimezones.reduce((acc, friend) => {
            const { timezone } = friend;
            if (!acc[timezone]) {
                acc[timezone] = [];
            }
            acc[timezone].push(friend);
            return acc;
        }, {});

        // Create indicators for each timezone group
        const legendContainer = document.getElementById('legendContainer');
        Object.values(timezonesToFriends).forEach(friendsInGroup => {
            const firstFriend = friendsInGroup[0];
            const names = friendsInGroup.map(f => f.name).join(', ');

            // Create the main container for this timezone group
            const friendContainer = document.createElement('div');
            friendContainer.className = 'friend-container';
            // Use a sanitized timezone string for the ID
            friendContainer.id = `container-${firstFriend.timezone.replace(/[:+]/g, '')}`;

            // Create the indicator line
            const indicator = document.createElement('div');
            indicator.className = 'timezone-indicator';
            indicator.style.background = firstFriend.color;
            indicator.style.boxShadow = `0 0 10px ${firstFriend.color}`;
            
            // Create the tooltip
            const tooltip = document.createElement('span');
            tooltip.className = 'tooltip';

            // Append elements to their containers
            friendContainer.appendChild(tooltip); // Tooltip is now a direct child for easier access
            friendContainer.appendChild(indicator);
            clockLine.appendChild(friendContainer);

            // Create legend item
            const legendItem = document.createElement('div');
            legendItem.className = 'legend-item';

            const colorSwatch = document.createElement('div');
            colorSwatch.className = 'legend-color-swatch';
            colorSwatch.style.backgroundColor = firstFriend.color;

            const nameSpan = document.createElement('span');
            nameSpan.className = 'legend-names';
            nameSpan.textContent = names;

            legendItem.append(colorSwatch, nameSpan);
            legendContainer.appendChild(legendItem);
        });

        function updateClocks() {
            const indicatorPositions = [];

            Object.values(timezonesToFriends).forEach(friendsInGroup => {
                const firstFriend = friendsInGroup[0];
                const containerId = `container-${firstFriend.timezone.replace(/[:+]/g, '')}`;
                const container = document.getElementById(containerId);
                const tooltip = container.querySelector('.tooltip');
                if (!container) return;

                // Get current time in the specified timezone
                const gmtString = firstFriend.timezone;
                const offsetString = gmtString.replace(/GMT/i, '').trim();

                // Parse hours and minutes from formats like "+5:30" or "-8"
                const parts = offsetString.split(':');
                const offsetHours = parseInt(parts[0], 10);
                let offsetMinutes = parts.length > 1 ? parseInt(parts[1], 10) : 0;

                if (isNaN(offsetHours) || isNaN(offsetMinutes)) {
                    console.error(`Invalid timezone format for ${firstFriend.name}: ${gmtString}`);
                    tooltip.textContent = 'Error';
                    return; // Skip to the next group
                }

                // Get the sign of the offset to apply it correctly to the minutes
                // If offsetHours is 0 or -0, sign is 0. Default to 1.
                // Also handle negative offsets like GMT-3:30 where the sign is on the hour.
                const sign = offsetHours < 0 ? -1 : 1;
                offsetMinutes = offsetMinutes * sign;

                // Calculate the time based on UTC and the offset
                const now = new Date();
                const totalOffsetInMinutes = (offsetHours * 60) + offsetMinutes;
                now.setUTCMinutes(now.getUTCMinutes() + totalOffsetInMinutes);

                // Extract the new local time components
                const hours = now.getUTCHours();
                const minutes = now.getUTCMinutes();
                const seconds = now.getUTCSeconds();

                // Update tooltip text
                const timeString = 
                    String(hours).padStart(2, '0') + ':' + 
                    String(minutes).padStart(2, '0') + ':' +
                    String(seconds).padStart(2, '0');
                tooltip.textContent = timeString;

                // Convert current time to a percentage of the day
                const totalSeconds = hours * 3600 + minutes * 60 + seconds;
                const totalSecondsInDay = 24 * 3600;
                const positionPercentage = (totalSeconds / totalSecondsInDay) * 100;

                // Update indicator position
                container.style.left = positionPercentage + '%';

                // Store position for staggering logic
                indicatorPositions.push({ id: containerId, pos: positionPercentage });
            });

            // Staggering logic
            indicatorPositions.sort((a, b) => a.pos - b.pos);
            for (let i = 0; i < indicatorPositions.length - 1; i++) {
                const current = indicatorPositions[i];
                const next = indicatorPositions[i + 1];
                const currentEl = document.getElementById(current.id);
                const nextEl = document.getElementById(next.id);

                // If indicators are too close (e.g., less than 3% apart), stagger the next one
                const isClose = (next.pos - current.pos) < 3;
                // This logic is no longer needed as names are removed
                // If you want to bring back staggering, you'd need a new visual approach
                // For now, we'll leave it out for a cleaner timeline.
                // nextEl.classList.toggle('staggered', isClose);
            }
        }

        // Initial update
        updateClocks();

        // Update every 100ms for smooth movement
        setInterval(updateClocks, 100);
    </script>
</body>
</html>
